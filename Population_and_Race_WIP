select 
distinct 
race 
from dbo.Police_Shootings_Geo_Location

SELECT 
	count([id]) as Victims,
	[race],
	[state]
    into #Police_Shootings_Geo_Location_State_group
from  dbo.Police_Shootings_Geo_Location
where county is not null
group by [race],[state]
drop table #Police_Shootings_Geo_Location_County_group

select top 1000 * from #Police_Shootings_Geo_Location_State_group
drop table #Police_Shootings_Geo_Location_County_group

select sum(case when race is not null then [Victims] end) as victims_total, 
[race],
[state] 
into #state_aggs
from #Police_Shootings_Geo_Location_State_group
group by [race], [state] 

drop table #county_aggs

select * from #county_aggs where race is not null

SELECT
a.[state],
sum(case when a.[race] is not null then a.[Victims] end) as Total_Victims_with_Race,
sum(case when a.[race]='B' then a.[Victims] end) as Black_total,
sum(case when a.[race]='W' then a.[Victims] end) as White_total,
sum(case when a.[race]='H' then a.[Victims] end) as Hispanic_total,
sum(case when a.[race]='A' then a.[Victims] end) as Asian_total,
sum(case when a.[race]='N' then a.[Victims] end) as Non_Hispanic_total
from #Police_Shootings_Geo_Location_State_group a
left join #state_aggs b on a.[state]=b.[state] and a.[race]=b.[race]
group by a.[state]

SELECT TOP (1000) [IBRC_Geo_ID]
      ,[Statefips]
      ,[Countyfips]
      ,a.[County]
      ,a.[State]
      ,[Year]
      ,[Total_Population]
      ,[White_perc]
      ,[Black_perc]
      ,[American_Indian_or_Alaskan_Native_perc]
      ,[Asian_perc]
      ,[Not_Hispanic_perc]
      ,[Hispanic_perc]
      ,b.[id]
  FROM [dbo].[Population_by_Race] a 
  left join dbo.Police_Shootings_Geo_Location b on a.County=b.County and a.[State]=b.State
